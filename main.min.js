var a='video';var b=document.getElementById('videoPlayer');var c='div#vid-overlay';var d='#vidAnnotation';var e='div.annotation-on-screen';var f='a#addAnnotation';var g='a.removeAnnotation';var h='a#playPauseButton';var i='progress#progress';var j='div#informationalText';var k='a#volume-down';var l='a#volume-up';var m='a#hidey-showy';var n='a#delete-everything-button';var o='a#toggle-annotations-button';var p='span#play-time';var q='#addAnnotationForm';var r='a#saveAddForm';var s='a#cancelAddForm';var t='#form-annotation-text';var u='#form-annotation-length';var v='#textTab';var w='#imageTab';var x='#textTabContent';var y='#imageTabContent';var z="#background-colour-button";var A="#text-colour-button";var B="rgba(89, 124, 86, 0.7)";var C="rgba(0, 0, 0, 1.0)";var D=400;var E=600;var F=0.55;var G=1.5;var H=document.getElementById('vid-canvas');var I=H.getContext('2d');var J=D;var K={};var L=false;var M=false;var N=0;var O=[];var P=false;var Q=false;var R=true;var S=3000;var T=false;var U=1;function V(a,b,c,d,e,f,g,h,i,j,k){this.textString=a;this.imageUrl=b;this.xPosition=c;this.yPosition=d;this.aWidth=e;this.aHeight=f;this.startTime=g;this.endTime=h;this.zIndex=i;this.backgroundColour=j;this.textColour=k;}function W(a){var b=(String(a.startTime))+(String(a.endTime))+(String(a.xPosition))+(String(a.yPosition))+(a.text);var c=CryptoJS.MD5(b);return c.toString();}function X(a){var b=new V(a,null,30,30,30,30,3,5,3000,B,C);O.push(b); }function Y(a){if(!R)return;var b=W(a);var d='<div class="annotation-on-screen" id="'+b+'"></div>';var e='div#'+b;$(c).append(d); var f=a.aHeight;if(f<20)f=20;var g=a.aWidth;if(g<30)g=30;g=(g*J/D);f=(f*J/D);var h=(a.xPosition*J/D);var i=(a.yPosition*J/D);var j=((J*F)-i);var k=(J-h);var l=B;if(a.backgroundColour)l=a.backgroundColour;var m=C;if(m!=null)m=a.textColour;$(e).css({"width":g,"height":f,"position":"absolute","padding":"5px","overflow":"auto","top":i,"left":h,"max-width":k,"max-height":j,"z-index":a.zIndex,"background-color":l,"color":m});var n=a.textString; if(n==null)n="";$(e).text(n);if(a.imageUrl!=null){var o='<img src="'+a.imageUrl+'"/>';$(e).append(o);var p=e+' img';$(p).css({"width":"100%","height":"auto"});}}function Z(a){var b=W(a);var c='div#'+b;$(c).remove();}function ab(){ $(p).text(al(N));if(T){$(e).remove();ac();T=false;return;}var a=$.grep(O,function(a){return(N>=a.startTime&&N<a.endTime);});var b=$.grep(O,function(a){return(N==a.startTime);});if(b!=null)if(b.length>0){ for(var c=0;c<b.length;c++){ var d=b[c]; Y(d);}}var f=$.grep(O,function(a){return(N==a.endTime);});if(f!=null)if(f.length>0){ for(var c=0;c<f.length;c++){ Z(f[c]);}} }function ac(){var a=$.grep(O,function(a){return(N>=a.startTime&&N<a.endTime);});if(a!=null)if(a.length>0){ for(var b=0;b<a.length;b++){ var c=a[b]; Y(c);}}}function ad(){var b=$(a).data('easyannotation-file-id');if(localStorage.getItem(b)){var c=JSON.parse(localStorage.getItem(b));if(c==null)O=[];else O=c;}else O=[];$(a).controls=false;O.sort(function(a,b){return a.startTime-b.startTime;});ao();ar();}function ae(){var b=JSON.stringify(O);var c=$(a).data('easyannotation-file-id');localStorage.setItem(c,b);}function af(){window.localStorage.clear();O=[]; }function ag(){$(f).fadeTo("fast",0);M=true; $(a).trigger('pause');$(j).text("Begin drawing over the video...");}function ah(){I.clearRect(0,0,H.width,H.height);M=false;$(j).text("");aw();}function ai(){var a=$(t).val();var b=$(u).val();$(f).fadeTo("fast",1);aw();$(t).val("");$(u).val("2");if(b==null||isNaN(b))b="2";var c=K.startX;var d=K.startY;var e=K.w;var g=K.h;if(P){c=(c/G);d=(d/G);e=(e/G);g=(g/G);}if(g<20)g=20;if(e<30)e=30;if(c+e>(D-10))c=390-e;if(d+g>((D*F)-10))d=210-g;var h=$(z).css("background-color");var i=$(A).css("background-color");if(a!=null&&a.length>0){var j=new V(a,null,c,d,e,g,N,(N+parseInt(b)),S,h,i);O.push(j);ae();ao();S=S+1;}else alert("An annotation title is required - please enter one.");}function aj(){aw();$(t).val("");$(u).val("2");$(f).fadeTo("fast",1);}function ak(){if(b.paused||b.ended){b.play();$(h).html('<i class="fa fa-pause"></i>');}else{b.pause();$(h).html('<i class="fa fa-play"></i>');}}function al(a){var b=Math.floor(a/60);var c=a-(b*60);if(c<10)c="0"+String(c);if(a<10)return "0:0"+String(a);if(a<60)return "0:"+String(a);return String(b)+":"+String(c);}function am(){var a=document.getElementById('progress');var c=Math.floor((100/b.duration)*(b.currentTime));a.value=c;a.innerHTML=c+"%";}function an(a){if(/^([a-z]([a-z]|\d|\+|-|\.)*):(\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?((\[(|(v[\da-f]{1,}\.(([a-z]|\d|-|\.|_|~)|[!\$&'\(\)\*\+,;=]|:)+))\])|((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=])*)(:\d*)?)(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*|(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)){0})(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a))return true;else return false;}function ao(){O.sort(function(a,b){return a.startTime-b.startTime;});$("li.vidAnnotationListItem").each(function(a){this.remove();});for(var a=0;a<O.length;a++){var b=O[a];var c='Text annotation';if(b.imageUrl!=null)c='Image annotation';var e='<li class="vidAnnotationListItem" style="background-color: '+b.backgroundColour+';" ><a class="removeAnnotation" href="#" data-easyannotation-annotation-id="'+a+'">X</a><div class="vidAnnotationType">'+c+'</div><div class="vidAnnotationTimes">'+al(b.startTime)+' - '+al(b.endTime)+'</div><div class="vidAnnotationContent" style="color: '+b.textColour+';">'+b.textString+'</div></li>';$("ul#vidAnnotationList").append(e);}if(O.length>0)$(d).css({'background-image':"none"});else $(d).css({'background-image':"url('resources/noAnnotations.png')"});}function ap(a){var b=O[a];Z(b);O.splice(a,1);ao();ae();}function aq(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top};}function ar(){H.addEventListener('mousedown',as,false);H.addEventListener('mouseup',at,false);H.addEventListener('mousemove',au,false);}function as(a){if(M){K.startX=aq(H,a).x;K.startY=aq(H,a).y; L=true;}}function at(){if(!M)return;L=false;ah();}function au(a){if(L&&M){ K.w=aq(H,a).x-K.startX;K.h=aq(H,a).y-K.startY;I.clearRect(0,0,H.width,H.height);av();}}function av(){if(M){I.fillStyle=B;I.fillRect(K.startX,K.startY,K.w,K.h);}}function aw(){if(Q){$(q).hide();$('#vidTitle').css('margin-top','14px');Q=false;}else{$(q).show();$('#vidTitle').css('margin-top','-200px');$(z).attr('value',B);$(A).attr('value',C);$(z).colorPicker();$(A).colorPicker();Q=true;}}$(document).ready(function(){ ad();$(q).hide();$(y).hide();$(a).bind('play',function(){ ab();$(h).html('<i class="fa fa-pause"></i>');});$(a).bind('pause',function(){ $(h).html('<i class="fa fa-play"></i>');});$(a).bind('ended',function(){ N=0;document.getElementById('progress').value=0;$(h).html('<i class="fa fa-play"></i>');$(e).remove();});$(a).bind('timeupdate',function(){am();var a=Math.floor(this.currentTime);if(a!=N){ N=a;ab();}});$(f).click(function(){ag();});$(r).click(function(){ai();});$(s).click(function(){aj();});$(h).click(function(){ak();});$(document).on('click',g,function(){var a=$(this).data('easyannotation-annotation-id');ap(a);});$(l).click(function(){if(b.volume==1)return;b.volume+=0.1;});$(k).click(function(){if(b.volume==0)return;b.volume-=0.1;});$(n).click(function(){var a=confirm('This will delete ALL annotations for every video in easyAnnotate. Do you wish to continue?');if(a){af();ae();ao();$(e).remove();}});$(v).click(function(){$(x).show();$(y).hide();$(v).addClass("selected");$(w).removeClass("selected");U=1;});$(w).click(function(){$(y).show();$(x).hide();$(w).addClass("selected");$(v).removeClass("selected");U=2;});$(m).click(function(){if(P){$(a).animate({"width":(D+"px")},function(){$(d).show();});$(this).text("Hide Annotation List");P=false;J=D;H.width=D;H.height=(D*F);var b=0.666;$('.annotation-on-screen').each(function(a,c){var d=$(this).width();var e=$(this).height();var f=$(this).position().left;var g=$(this).position().top;var h=d*b;var i=e*b;var j=f*b;var k=g*b;$(this).animate({width:h+'px',height:i+'px',left:j+'px',top:k+'px'}); });$(q).animate({"top":"330px"});}else{$(a).animate({"width":"600px"});$(d).hide();$(this).text("Show Annotation List");P=true;J=E;H.width=E;H.height=(E*F);$('.annotation-on-screen').each(function(a,b){var c=$(this).width();var d=$(this).height();var e=$(this).position().left;var f=$(this).position().top;var g=c*G;var h=d*G;var i=e*G;var j=f*G;$(this).animate({width:g+'px',height:h+'px',left:i+'px',top:j+'px'}); });$(q).animate({"top":"440px"});}});$(o).click(function(){if(R){R=false;$(this).text("Turn on annotations");$(e).remove();}else{R=true;$(this).text("Turn off annotations");ac();}});$(i).bind('click',function(a){var c=$(i).offset().left;var d=a.clientX-c;var e=((d/b.duration)/2); if(e>=0&&e<=b.duration){T=true;b.currentTime=e;}});Mousetrap.bind('space',function(){$(h).trigger('click');});Mousetrap.bind('up',function(){$(l).trigger('click');});Mousetrap.bind('down',function(){$(k).trigger('click');});Mousetrap.bind('n',function(){ag();});Mousetrap.bind('h',function(){$(m).trigger('click');});Mousetrap.bind('a',function(){$(o).trigger('click');});});