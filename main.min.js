var a='video';var b=document.getElementById('videoPlayer');var c='div#vid-overlay';var d='#vidAnnotation';var e='div.annotation-on-screen';var f='a#addAnnotation';var g='a.removeAnnotation';var h='a#playPauseButton';var i='progress#progress';var j='div#informationalText';var k='a#volume-down';var l='a#volume-up';var m='a#hidey-showy';var n='a#delete-everything-button';var o='a#toggle-annotations-button';var p='span#play-time';var q='#addAnnotationForm';var r='a#saveAddForm';var s='a#cancelAddForm';var t='#form-annotation-text';var u='#form-annotation-length';var v='#form-annotation-link';var w='canvas';var x='form#videoURL';var y='a#change-video-button';var z='#videoURLSubmit';var A='#form-video-URL';var B='#form-image-url';var C='#textTab';var D='#imageTab';var E='#textTabContent';var F='#imageTabContent';var G="#background-colour-button";var H="#text-colour-button";var I="rgba(89, 124, 86, 0.7)";var J="rgba(255, 255, 255, 1.0)";var K=400;var L=220;var M=600;var N=330;var O=0.55;var P=1.5;var Q=document.getElementById('vid-canvas');var R=Q.getContext('2d');var S=K;var T=L;var U={};var V=false;var W=false;var X=0;var Y=[];var Z=false;var ab=false;var ac=true;var ad=3000;var ae=false;var af=1;var ag=16;function ah(a,b,c,d,e,f,g,h,i,j,k,l){this.textString=a;this.imageUrl=b;this.xPosition=c;this.yPosition=d;this.aWidth=e;this.aHeight=f;this.startTime=g;this.endTime=h;this.zIndex=i;this.backgroundColour=j;this.textColour=k;this.link=l;}function ai(a){var b=(String(a.startTime))+(String(a.endTime))+(String(a.xPosition))+(String(a.yPosition))+(String(a.text));var c=CryptoJS.MD5(b);return c.toString();}function aj(a){var b=new ah(a,null,30,30,30,30,3,5,3000,I,J,null);Y.push(b); }function ak(a){if(!ac)return;var b=ai(a);var d='';if(a.link!=null&&a.link.length>0)d=a.link;var e='<div class="annotation-on-screen" data-easyannotation-annotation-href="'+d+'" title="'+d+'" id="'+b+'"></div>';var f='div#'+b;$(c).append(e); var g=a.aHeight;if(g<20)g=20;var h=a.aWidth;if(h<30)h=30;h=(h*S/K);g=(g*S/K);var i=(a.xPosition*S/K);var j=(a.yPosition*S/K);var k=((S*O)-j);var l=(S-i);var m=I;if(a.backgroundColour)m=a.backgroundColour;var n=J;if(n!=null)n=a.textColour;$(f).css({"width":h,"height":g,"position":"absolute","padding":"5px","overflow":"auto","top":j,"left":i,"max-width":l,"max-height":k,"z-index":a.zIndex,"background-color":m,"color":n});$(f).addClass('no-select');var o=a.textString; if(o==null)o="";o='<p>'+o+'</p>';$(f).html(o);if(a.imageUrl!=null){var p='<img src="'+a.imageUrl+'"/>';$(f).append(p);var q=f+' img';$(q).css({"width":"100%","height":"auto"});}}function al(a){var b=ai(a);var c='div#'+b;$(c).remove();}function am(){ $(p).text(ay(X));if(ae){$(e).remove();an();ae=false;return;}var a=$.grep(Y,function(a){return(X>=a.startTime&&X<a.endTime);});var b=$.grep(Y,function(a){return(X==a.startTime);});if(b!=null)if(b.length>0){ for(var c=0;c<b.length;c++){ var d=b[c]; ak(d);}}var f=$.grep(Y,function(a){return(X==a.endTime);});if(f!=null)if(f.length>0){ for(var c=0;c<f.length;c++){ al(f[c]);}} }function an(){var a=$.grep(Y,function(a){return(X>=a.startTime&&X<a.endTime);});if(a!=null)if(a.length>0){ for(var b=0;b<a.length;b++){ var c=a[b]; ak(c);}}}function ao(){var b=$(a).attr('data-easyannotation-file-id'); if(localStorage.getItem(b)){var c=JSON.parse(localStorage.getItem(b));if(c==null)Y=[];else Y=c;}else Y=[];$(a).controls=false;Y.sort(function(a,b){return a.startTime-b.startTime;});aB();aF();}function ap(){var b=JSON.stringify(Y);var c=$(a).data('easyannotation-file-id');localStorage.setItem(c,b);}function aq(){window.localStorage.clear();Y=[]; }function ar(){$(f).fadeTo("fast",0);$(w).css('z-index',5000);W=true; $(a).trigger('pause');$(j).text("Begin drawing over the video...(press escape to exit)");}function as(){R.clearRect(0,0,Q.width,Q.height);W=false;$(j).text("");aK();$(w).css('z-index',2000);}function at(){var a=$(t).val();var b=$(v).val();if(b!=null&&b.length>0)if(aA(b)||b.length<4) else{alert('Invalid link URL! Please check and try again...');return;}else b=null;var c=$(u).val();var d=$(B).val();if(d!=null&&d.length>0)if(aA(d)||d.length<4)a=' ';else{alert('Invalid image URL! Please check and try again...');return;}else d=null;$(f).fadeTo("fast",1);aK();av();if(c==null||isNaN(c))c="2";var e=U.startX;var g=U.startY;var h=U.w;var i=U.h;if(Z){e=(e/P);g=(g/P);h=(h/P);i=(i/P);}if(i<20)i=20;if(h<30)h=30;if(e+h>(K-10))e=390-h;if(g+i>((K*O)-10))g=210-i;var j=$(G).css("background-color");var k=$(H).css("background-color");if(a!=null&&a.length>0){var l=new ah(a,d,e,g,h,i,X,(X+parseInt(c)),ad,j,k,b);Y.push(l);ap();aB();ad=ad+1;}else alert("An annotation title is required - please enter one.");}function au(){var a=$(A).val();var c=CryptoJS.MD5(a);if(!aA(a))return false;$(b).attr('data-easyannotation-file-id',c);$(b).find('#MP4-video').attr('src',a);$(b).bind("loadedmetadata",function(){var a=this.videoWidth;var c=this.videoHeight;  if((a/c)>1.818){var d=S;$(b).width(d);}else{var e=T;$(b).height(e);}}); $(b).load();Y=[];aB();ao(); }function av(){$(t).val("");$(v).val("");$(B).val("");$(u).val("2");}function aw(){aK();av();$(f).fadeTo("fast",1);}function ax(){if(b.paused||b.ended){b.play();$(h).html('<i class="fa fa-pause"></i>');}else{b.pause();$(h).html('<i class="fa fa-play"></i>');}}function ay(a){var b=Math.floor(a/60);var c=a-(b*60);if(c<10)c="0"+String(c);if(a<10)return "0:0"+String(a);if(a<60)return "0:"+String(a);return String(b)+":"+String(c);}function az(){var a=document.getElementById('progress');var c=Math.floor((100/b.duration)*(b.currentTime));a.value=c;a.innerHTML=c+"%";}function aA(a){if(/^([a-z]([a-z]|\d|\+|-|\.)*):(\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?((\[(|(v[\da-f]{1,}\.(([a-z]|\d|-|\.|_|~)|[!\$&'\(\)\*\+,;=]|:)+))\])|((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=])*)(:\d*)?)(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*|(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)){0})(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a))return true;else return false;}function aB(){Y.sort(function(a,b){return a.startTime-b.startTime;});$("li.vidAnnotationListItem").each(function(a){this.remove();});for(var a=0;a<Y.length;a++){var b=Y[a];var c='Text annotation';var e='';if(b.imageUrl!=null){c='Image annotation';e='<img style="width: 100%; height: auto; margin-top: 5px;" src="'+b.imageUrl+'"/>';}var f='';var g=''; if(b.link!=null){if(b.link.length>35)g=b.link.substring(0,32)+"...";else g=b.link;f='<div class="annotationLink" title="'+b.link+'"><a href="'+b.link+'" target="_blank"><i class="fa fa-link"></i>&nbsp;'+g+'</a></div>';} var h='<li class="vidAnnotationListItem" style="background-color: '+b.backgroundColour+';" ><a class="removeAnnotation" href="#" data-easyannotation-annotation-id="'+a+'">X</a><div class="vidAnnotationType">'+c+'</div><div class="vidAnnotationTimes">'+ay(b.startTime)+' - '+ay(b.endTime)+'</div><div class="vidAnnotationContent" style="color: '+b.textColour+';">'+e+b.textString+'</div>'+f+'</li>';$("ul#vidAnnotationList").append(h);}if(Y.length>0)$(d).css({'background-image':"none"});else $(d).css({'background-image':"url('resources/noAnnotations.png')"});}function aC(){$("li.vidAnnotationListItem").each(function(){this.remove();});}function aD(a){var b=Y[a];al(b);Y.splice(a,1);aB();ap();}function aE(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top};}function aF(){Q.addEventListener('mousedown',aG,false);Q.addEventListener('mouseup',aH,false);Q.addEventListener('mousemove',aI,false);}function aG(a){if(W){U.startX=aE(Q,a).x;U.startY=aE(Q,a).y; V=true;}}function aH(){if(!W)return;V=false;as();}function aI(a){if(V&&W){ U.w=aE(Q,a).x-U.startX;U.h=aE(Q,a).y-U.startY;R.clearRect(0,0,Q.width,Q.height);aJ();}}function aJ(){if(W){R.fillStyle=I;R.fillRect(U.startX,U.startY,U.w,U.h);}}function aK(){if(ab){$(q).hide();$('#vidTitle').css('margin-top','14px');ab=false;}else{$(q).show();$('#vidTitle').css('margin-top','-200px');$(G).attr('value',I);$(H).attr('value',J);$(G).colorPicker();$(H).colorPicker();ab=true;}}function aL(){if($(x).is(":visible"))$(x).hide("fast");else $(x).show("fast");}$(document).ready(function(){ ao();$(q).hide();$(F).hide();$(x).hide();$(a).bind('play',function(){ am();$(h).html('<i class="fa fa-pause"></i>');});$(a).bind('pause',function(){ $(h).html('<i class="fa fa-play"></i>');});$(a).bind('ended',function(){ X=0;document.getElementById('progress').value=0;$(h).html('<i class="fa fa-play"></i>');$(e).remove();});$(a).bind('timeupdate',function(){az();var a=Math.floor(this.currentTime);if(a!=X){ X=a;am();}});$(f).click(function(){ar();});$(r).click(function(){at();});$(s).click(function(){aw();});$(h).click(function(){ax();});$(z).click(function(){au();});$(document).on('click',g,function(){var a=$(this).data('easyannotation-annotation-id');aD(a);});$(document).on('click',e,function(){ var a=$(this).data('easyannotation-annotation-href');if(a.length>1){if(!b.paused)$(h).trigger('click');window.open(a,'_blank');}});$(l).click(function(){if(b.volume==1)return;b.volume+=0.1;});$(k).click(function(){if(b.volume==0)return;b.volume-=0.1;});$(n).click(function(){var a=confirm('This will delete ALL annotations for every video in easyAnnotate. Do you wish to continue?');if(a){aq();ap();aB();$(e).remove();}});$(y).click(function(){aL();});$(C).click(function(){$(E).show();$(F).hide();$(C).addClass("selected");$(D).removeClass("selected");af=1;});$(D).click(function(){$(F).show();$(E).hide();$(D).addClass("selected");$(C).removeClass("selected");af=2;});$(m).click(function(){if(Z){$(a).animate({"width":(K+"px")},function(){$(d).show();});$(this).text("Hide Annotation List");Z=false;S=K;T=L;Q.width=K;Q.height=(K*O);var b=0.666;ag=ag*b;$('.annotation-on-screen').each(function(a,c){var d=$(this).width();var e=$(this).height();var f=$(this).position().left;var g=$(this).position().top;var h=d*b;var i=e*b;var j=f*b;var k=g*b;$(this).animate({width:h+'px',height:i+'px',left:j+'px',top:k+'px'}); });$(q).animate({"top":"330px"});}else{$(a).animate({"width":"600px"});$(d).hide();$(this).text("Show Annotation List");Z=true;S=M;T=N;Q.width=M;Q.height=(M*O); ag=ag*P;$('.annotation-on-screen').each(function(a,b){var c=$(this).width();var d=$(this).height();var e=$(this).position().left;var f=$(this).position().top;var g=c*P;var h=d*P;var i=e*P;var j=f*P;$(this).animate({width:g+'px',height:h+'px',left:i+'px',top:j+'px'});$(this).css('font-size',ag+'px');  });$(q).animate({"top":"440px"});}});$(o).click(function(){if(ac){ac=false;$(this).text("Turn on annotations");$(e).remove();}else{ac=true;$(this).text("Turn off annotations");an();}});$(i).bind('click',function(a){var c=$(i).offset().left;var d=a.clientX-c;var e=((d/b.duration)/2); if(e>=0&&e<=b.duration){ae=true;b.currentTime=e;}});Mousetrap.bind('space',function(){$(h).trigger('click');});Mousetrap.bind('up',function(){$(l).trigger('click');});Mousetrap.bind('down',function(){$(k).trigger('click');});Mousetrap.bind('n',function(){ar();});Mousetrap.bind('h',function(){$(m).trigger('click');});Mousetrap.bind('a',function(){$(o).trigger('click');});Mousetrap.bind('esc',function(){if(W==true){W=false;$(j).text('');$(f).fadeTo("fast",1);}else if($(q).is(':visible'))aw();});});