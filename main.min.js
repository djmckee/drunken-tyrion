var a='video';var b='div#vid-overlay';var c='a#addAnnotation';var d='a.removeAnnotation';var e='a#playPauseButton';var f='progress#progress';var g='div#informationalText';var h='a#volume-down';var i='a#volume-up';var j=document.getElementById('vid-canvas');var k=j.getContext('2d');var l={};var m=false;var n=false;var o=0;var p=[];function q(a,b,c,d,e,f,g,h){this.textString=a;this.imageUrl=b;this.xPosition=c;this.yPosition=d;this.aWidth=e;this.aHeight=f;this.startTime=g;this.endTime=h;}function r(a){var b=(String(a.startTime))+(String(a.endTime))+(String(a.xPosition))+(String(a.yPosition))+(a.text);var c=CryptoJS.MD5(b);return c.toString();}function s(a){var b=new q(a,null,30,30,30,30,3,5);p.push(b);console.log(p);}function t(a){var c=r(a);var d='<div class="annotation-on-screen" id="'+c+'"></div>';var e='div#'+c;$(b).append(d);console.log('attempting to add:'+d);$(e).css({"width":a.aWidth,"height":a.aHeight,"position":"relative","top":a.yPosition,"left":a.xPosition});var f=a.textString;console.log('annotation title: '+f);if(f==null)f="";$(e).text(f);if(a.imageUrl!=null){var g='<img src="'+a.imageUrl+'"/>';$(e).append(g);var h=e+' img';$(h).css({"width":"100%","height":"auto"});}}function u(a){var b=r(a);var c='div#'+b;$(c).remove();}function v(){console.log('update called.');var a=$.grep(p,function(a){return(o>=a.startTime&&o<a.endTime);});var b=$.grep(p,function(a){return(o==a.startTime);});if(b!=null)if(b.length>0){console.log('have new annotations to load');for(var c=0;c<b.length;c++){console.log('need to add something.');var d=b[c];console.log(d);t(d);}}var e=$.grep(p,function(a){return(o==a.endTime);});if(e!=null)if(e.length>0){console.log('have old annotations to remove');for(var c=0;c<e.length;c++){console.log('need to remove something.');u(e[c]);}}console.log(a);}function w(){var b=$(a).data('easyannotation-file-id');if(localStorage.getItem(b)){var c=JSON.parse(localStorage.getItem(b));if(c==null)p=[];else p=c;}else p=[];$(a).controls=false;p.sort(function(a,b){return a.startTime-b.startTime;});E();H();}function x(){var b=JSON.stringify(p);var c=$(a).data('easyannotation-file-id');localStorage.setItem(c,b);}function y(){window.localStorage.clear();p=[];console.log('Local storage cleared.');}function z(){n=true;console.log('Starting to add annotation...');$(a).trigger('pause');$(g).text("Begin drawing over the video...");}function A(){k.clearRect(0,0,j.width,j.height);n=false;$(g).text("");var a=prompt("Please enter your annotation text:","");var b=prompt("Please enter how long you want the annotation to stay on screen:","");if(b==null||isNaN(b))b="2";var c=l.startX;var d=l.startY;var e=l.w;var f=l.h;if(e<20)e=20;if(e<40)e=40;if(a!=null&&a.length>0){var h=new q(a,null,c,d,e,f,o,(o+parseInt(b)));p.push(h);x();E();}}function B(){if(document.getElementById('videoPlayer').paused||document.getElementById('videoPlayer').ended){document.getElementById('videoPlayer').play();$(e).html('<i class="fa fa-pause"></i>');}else{document.getElementById('videoPlayer').pause();$(e).html('<i class="fa fa-play"></i>');}}function C(a){if(a<10)return "0:0"+String(a);if(a<60)return "0:"+String(a);var b=Math.floor(a/60);var c=a-(b*60);return String(b)+":"+String(c);}function D(){var a=document.getElementById('progress');var b=Math.floor((100/document.getElementById('videoPlayer').duration)*(document.getElementById('videoPlayer').currentTime));a.value=b;a.innerHTML=b+"%";}function E(){p.sort(function(a,b){return a.startTime-b.startTime;});$("li.vidAnnotationListItem").each(function(a){this.remove();});for(var a=0;a<p.length;a++){var b=p[a];var c='<li class="vidAnnotationListItem"><a class="removeAnnotation" href="#" data-annotation-id="'+a+'">X</a><div class="vidAnnotationType">Text annotation</div><div class="vidAnnotationTimes">'+C(b.startTime)+' - '+C(b.endTime)+'</div><div class="vidAnnotationContent">'+b.textString+'</div></li>';$("ul#vidAnnotationList").append(c);}}function F(a){p.splice(a,1);E();x();}function G(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top};}function H(){j.addEventListener('mousedown',I,false);j.addEventListener('mouseup',J,false);j.addEventListener('mousemove',K,false);}function I(a){if(n){l.startX=G(j,a).x;l.startY=G(j,a).y;console.log(l);m=true;}}function J(){if(!n)return;m=false;A();}function K(a){if(m&&n){console.log('pageX: '+a.pageX+' pageY: '+a.pageY);l.w=G(j,a).x-l.startX;l.h=G(j,a).y-l.startY;k.clearRect(0,0,j.width,j.height);L();}}function L(){if(n){k.fillStyle="rgba(89, 124, 86, 0.85)";k.fillRect(l.startX,l.startY,l.w,l.h);}}$(document).ready(function(){console.log('ready');w();$(a).bind('play',function(){console.log('started playing.');v();});$(a).bind('pause',function(){console.log('playback paused.');$(e).html('<i class="fa fa-play"></i>');});$(a).bind('ended',function(){console.log('finished playing.');o=0;document.getElementById('progress').value=0;});$(a).bind('timeupdate',function(){var a=Math.floor(this.currentTime);if(a!=o){console.log('seconds changed: '+a);o=a;D();v();}});$(c).click(function(){z();});$(e).click(function(){B();});$(document).on('click',d,function(){var a=$(this).data('annotation-id');F(a);});$(i).click(function(){if(document.getElementById('videoPlayer').volume==1)return;document.getElementById('videoPlayer').volume+=0.1;});$(h).click(function(){if(document.getElementById('videoPlayer').volume==0)return;document.getElementById('videoPlayer').volume-=0.1;});$("#showVA").hide();$("#hideVA").click(function(){$("#hideVA").hide();$("#showVA").show();$(a).animate({"width":"600px"});$('#vidAnnotation').hide();});$("#showVA").click(function(){$("#showVA").hide();$("#hideVA").show();$(a).animate({"width":"400px"},function(){$("#vidAnnotation").show();});});});