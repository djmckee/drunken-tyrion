var a='video';var b=document.getElementById('videoPlayer');var c='div#vid-overlay';var d='a#addAnnotation';var e='a.removeAnnotation';var f='a#playPauseButton';var g='progress#progress';var h='div#informationalText';var i='a#volume-down';var j='a#volume-up';var k='a#hidey-showy';var l='a#delete-everything-button';var m=document.getElementById('vid-canvas');var n=m.getContext('2d');var o={};var p=false;var q=false;var r=0;var s=[];var t=false;function u(a,b,c,d,e,f,g,h){this.textString=a;this.imageUrl=b;this.xPosition=c;this.yPosition=d;this.aWidth=e;this.aHeight=f;this.startTime=g;this.endTime=h;}function v(a){var b=(String(a.startTime))+(String(a.endTime))+(String(a.xPosition))+(String(a.yPosition))+(a.text);var c=CryptoJS.MD5(b);return c.toString();}function w(a){var b=new u(a,null,30,30,30,30,3,5);s.push(b);console.log(s);}function x(a){var b=v(a);var d='<div class="annotation-on-screen" id="'+b+'"></div>';var e='div#'+b;$(c).append(d);console.log('attempting to add:'+d);var f=a.aHeight;if(f<20)f=20;var g=a.aWidth;if(g<30)g=30;$(e).css({"width":g,"height":f,"position":"relative","top":a.yPosition,"left":a.xPosition});var h=a.textString;console.log('annotation title: '+h);if(h==null)h="";$(e).text(h);if(a.imageUrl!=null){var i='<img src="'+a.imageUrl+'"/>';$(e).append(i);var j=e+' img';$(j).css({"width":"100%","height":"auto"});}}function y(a){var b=v(a);var c='div#'+b;$(c).remove();}function z(){console.log('update called.');var a=$.grep(s,function(a){return(r>=a.startTime&&r<a.endTime);});var b=$.grep(s,function(a){return(r==a.startTime);});if(b!=null)if(b.length>0){console.log('have new annotations to load');for(var c=0;c<b.length;c++){console.log('need to add something.');var d=b[c];console.log(d);x(d);}}var e=$.grep(s,function(a){return(r==a.endTime);});if(e!=null)if(e.length>0){console.log('have old annotations to remove');for(var c=0;c<e.length;c++){console.log('need to remove something.');y(e[c]);}}console.log(a);}function A(){var b=$(a).data('easyannotation-file-id');if(localStorage.getItem(b)){var c=JSON.parse(localStorage.getItem(b));if(c==null)s=[];else s=c;}else s=[];$(a).controls=false;s.sort(function(a,b){return a.startTime-b.startTime;});I();L();}function B(){var b=JSON.stringify(s);var c=$(a).data('easyannotation-file-id');localStorage.setItem(c,b);}function C(){window.localStorage.clear();s=[];console.log('Local storage cleared.');}function D(){q=true;console.log('Starting to add annotation...');$(a).trigger('pause');$(h).text("Begin drawing over the video...");}function E(){n.clearRect(0,0,m.width,m.height);q=false;$(h).text("");var a=prompt("Please enter your annotation text:","");var b=prompt("Please enter how long you want the annotation to stay on screen:","");if(b==null||isNaN(b))b="2";var c=o.startX;var d=o.startY;var e=o.w;var f=o.h;if(f<20)f=20;if(e<30)e=30;if(a!=null&&a.length>0){var g=new u(a,null,c,d,e,f,r,(r+parseInt(b)));s.push(g);B();I();}}function F(){if(b.paused||b.ended){b.play();$(f).html('<i class="fa fa-pause"></i>');}else{b.pause();$(f).html('<i class="fa fa-play"></i>');}}function G(a){if(a<10)return "0:0"+String(a);if(a<60)return "0:"+String(a);var b=Math.floor(a/60);var c=a-(b*60);return String(b)+":"+String(c);}function H(){var a=document.getElementById('progress');var c=Math.floor((100/b.duration)*(b.currentTime));a.value=c;a.innerHTML=c+"%";}function I(){s.sort(function(a,b){return a.startTime-b.startTime;});$("li.vidAnnotationListItem").each(function(a){this.remove();});for(var a=0;a<s.length;a++){var b=s[a];var c='<li class="vidAnnotationListItem"><a class="removeAnnotation" href="#" data-annotation-id="'+a+'">X</a><div class="vidAnnotationType">Text annotation</div><div class="vidAnnotationTimes">'+G(b.startTime)+' - '+G(b.endTime)+'</div><div class="vidAnnotationContent">'+b.textString+'</div></li>';$("ul#vidAnnotationList").append(c);}}function J(a){var b=s[i];y(b);s.splice(a,1);I();B();}function K(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top};}function L(){m.addEventListener('mousedown',M,false);m.addEventListener('mouseup',N,false);m.addEventListener('mousemove',O,false);}function M(a){if(q){o.startX=K(m,a).x;o.startY=K(m,a).y;console.log(o);p=true;}}function N(){if(!q)return;p=false;E();}function O(a){if(p&&q){console.log('pageX: '+a.pageX+' pageY: '+a.pageY);o.w=K(m,a).x-o.startX;o.h=K(m,a).y-o.startY;n.clearRect(0,0,m.width,m.height);P();}}function P(){if(q){n.fillStyle="rgba(89, 124, 86, 0.85)";n.fillRect(o.startX,o.startY,o.w,o.h);}}$(document).ready(function(){console.log('ready');A();$(a).bind('play',function(){console.log('started playing.');z();$(f).html('<i class="fa fa-pause"></i>');});$(a).bind('pause',function(){console.log('playback paused.');$(f).html('<i class="fa fa-play"></i>');});$(a).bind('ended',function(){console.log('finished playing.');r=0;document.getElementById('progress').value=0;$(f).html('<i class="fa fa-play"></i>');});$(a).bind('timeupdate',function(){H();var a=Math.floor(this.currentTime);if(a!=r){console.log('seconds changed: '+a);r=a;z();}});$(d).click(function(){D();});$(f).click(function(){F();});$(document).on('click',e,function(){var a=$(this).data('annotation-id');J(a);});$(j).click(function(){if(b.volume==1)return;b.volume+=0.1;});$(i).click(function(){if(b.volume==0)return;b.volume-=0.1;});$(l).click(function(){var a=confirm('This will delete ALL annotations for every video in easyAnnotate. Do you wish to continue?');if(a){C();B();I();$('div.annotation-on-screen').remove();}});$(k).click(function(){if(t){$(a).animate({"width":"400px"},function(){$("#vidAnnotation").show();});$(this).text("Hide Annotation List");t=false;}else{$(a).animate({"width":"600px"});$('#vidAnnotation').hide();$(this).text("Show Annotation List");t=true;}});});