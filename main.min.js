var a='video';var b='div#vid-overlay';var c='a#addAnnotation';var d='button#playPauseButton';var e=0;var f=[];function g(a,b,c,d,e,f,g,h){this.textString=a;this.imageUrl=b;this.xPosition=c;this.yPosition=d;this.aWidth=e;this.aHeight=f;this.startTime=g;this.endTime=h;}function h(a){var b=(String(a.startTime))+(String(a.endTime))+(String(a.xPosition))+(String(a.yPosition))+(a.text);var c=CryptoJS.MD5(b);return c.toString();}function i(a){var b=new g(a,null,30,30,30,30,3,5);f.push(b);console.log(f);}function j(a){var c=h(a);var d='<div class="annotation-on-screen" id="'+c+'"></div>';var e='div#'+c;$(b).append(d);console.log('attempting to add:'+d);$(e).css({"width":a.aWidth,"height":a.aHeight});var f=a.textString;console.log('annotation title: '+f);if(f==null)f="";$(e).text(f);if(a.imageUrl!=null){var g='<img src="'+a.imageUrl+'"/>';$(e).append(g);var i=e+' img';$(i).css({"width":"100%","height":"auto"});}}function k(a){var b=h(a);var c='div#'+b;$(c).remove();}function l(){console.log('update called.');var a=$.grep(f,function(a){return(e>=a.startTime&&e<a.endTime);});var b=$.grep(f,function(a){return(e==a.startTime);});if(b!=null)if(b.length>0){console.log('have new annotations to load');for(var c=0;c<b.length;c++){console.log('need to add something.');var d=b[c];console.log(d);j(d);}}var g=$.grep(f,function(a){return(e==a.endTime);});if(g!=null)if(g.length>0){console.log('have old annotations to remove');for(var c=0;c<g.length;c++){console.log('need to remove something.');k(g[c]);}}console.log(a);}function m(){var b=$(a).data('easyannotation-file-id');if(localStorage.getItem(b)){var c=JSON.parse(localStorage.getItem(b));if(c==null)f=[];else f=c;}else f=[];$(a).controls=false;}function n(){var b=JSON.stringify(f);var c=$(a).data('easyannotation-file-id');localStorage.setItem(c,b);}function o(){window.localStorage.clear();f=[];console.log('Local storage cleared.');}function p(){console.log('Starting to add annotation...');$(a).trigger('pause');var b=prompt("Please enter your annotation text:","");if(b!=null){var c=new g(b,null,0,0,180,45,e,(e+2));f.push(c);n();}}function q(){if(document.getElementById('videoPlayer').paused||document.getElementById('videoPlayer').ended){document.getElementById('videoPlayer').play();$(d).text("Pause");}else{document.getElementById('videoPlayer').pause();$(d).text("Play");}}$(document).ready(function(){console.log('ready');m();$(a).bind("play",function(){console.log('started playing.');l();});$(a).bind('pause',function(){console.log('playback paused.');$(d).text("Play");});$(a).bind('ended',function(){console.log('finished playing.');e=0;});$(a).bind('timeupdate',function(){newTime=Math.floor(this.currentTime);if(newTime!=e){console.log('seconds changed: '+newTime);e=newTime;l();}});$(c).click(function(){p();});$(d).click(function(){q();});});